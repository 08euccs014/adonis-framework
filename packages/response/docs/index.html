<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>node-res</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.js" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">node-res</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1> node-res</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<p><img src="https://res.cloudinary.com/adonisjs/image/upload/q_100/v1547538578/node-res_jprexg.png" alt=""></p>
				<div align="center">
					<strong>Facade over <a href="https://nodejs.org/api/http.html#http_class_http_serverresponse">res</a> object to consistently make HTTP response.</strong>
				</div>
				<br />
				<div align="center">
					<!-- NPM version -->
					<a href="https://npmjs.org/package/node-res">
						<img src="https://img.shields.io/npm/v/node-res.svg?style=flat-square"
						alt="NPM version" />
					</a>
					<!-- Build Status -->
					<a href="https://travis-ci.org/RelayIN/node-res">
						<img src="https://img.shields.io/travis/RelayIN/node-res/master.svg?style=flat-square"
						alt="Build Status" />
					</a>
					<!-- Test Coverage -->
					<a href="https://coveralls.io/github/RelayIN/node-res">
						<img src="https://img.shields.io/coveralls/github/RelayIN/node-res/master.svg?style=flat-square"
						alt="Test Coverage" />
					</a>
					<!-- Downloads -->
					<a href="https://npmjs.org/package/node-res">
						<img src="https://img.shields.io/npm/dt/node-res.svg?style=flat-square"
						alt="Download" />
					</a>
				</div>
				<br />
				<br />
				<p>Node res is a facade to be <strong>used by any framework</strong> to send HTTP response from a given request. The <a href="https://nodejs.org/api/http.html#http_class_http_serverresponse">res</a> object of Node.js is very low level and not enjoyable to work with.</p>
				<!-- START doctoc generated TOC please keep comment here to allow auto update -->
				<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
				<h2 id="table-of-contents">Table of contents</h2>
				<ul>
					<li><a href="#features">Features</a></li>
					<li><a href="#getting-started">Getting started</a><ul>
							<li><a href="#raw-nodejs-api">Raw Node.js API</a></li>
						</ul>
					</li>
					<li><a href="#explicit-mode">Explicit Mode</a></li>
					<li><a href="#typescript-support">Typescript support</a></li>
					<li><a href="#extending-via-macros">Extending via Macros</a></li>
					<li><a href="#difference-from-other-frameworks">Difference from other frameworks</a></li>
					<li><a href="#api">API</a></li>
				</ul>
				<!-- END doctoc generated TOC please keep comment here to allow auto update -->
				<h2 id="features">Features</h2>
				<ul>
					<li>Support for <strong>JSON, JSONP</strong> response types.</li>
					<li>Automatically generates <strong>etag</strong> to enable caching.</li>
					<li>Serializes response body and set appropriate headers for it.</li>
					<li>Elegantly closes readable stream when piping a stream to the response.</li>
					<li>Files download.</li>
					<li>Helper methods.</li>
					<li>Typings support</li>
					<li>Extendable from outside</li>
					<li>Thoroughly tested.</li>
				</ul>
				<h2 id="getting-started">Getting started</h2>
				<p>Install the package from npm as follows:</p>
				<pre><code class="language-sh">npm i node-res

<span class="hljs-comment"># yarn</span>
yarn add node-res</code></pre>
				<p>and then use it by importing it as follows:</p>
				<pre><code class="language-js"><span class="hljs-keyword">const</span> { Response } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node-res'</span>)
<span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)

<span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">etag</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">jsonpCallbackName</span>: <span class="hljs-string">'callback'</span>
}

http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">new</span> Response(req, res, options)
  response.status(<span class="hljs-number">201</span>).json({ <span class="hljs-attr">ok</span>: <span class="hljs-literal">true</span> })
})</code></pre>
				<h4 id="raw-node-js-api">Raw Node.js API</h4>
				<pre><code class="language-js">http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">const</span> body = <span class="hljs-built_in">JSON</span>.stringify({ <span class="hljs-attr">ok</span>: <span class="hljs-literal">true</span> })

  res.statusCode = <span class="hljs-number">201</span>
  res.setHeader(<span class="hljs-string">'content-type'</span>, <span class="hljs-string">'application/json'</span>)
  res.setHeader(<span class="hljs-string">'content-length'</span>, Buffer.byteLength(body))
  res.write(body)
  res.end()
})</code></pre>
				<p>As you can see, sending JSON response from the raw <code>res</code> object requires little bit of extra work and the purpose of this module is to abstract those low level API&#39;s to a consistent set of high level API&#39;s.</p>
				<h2 id="explicit-mode">Explicit Mode</h2>
				<blockquote>
					<p>This mode is used by <a href="https://adonisjs.com">AdonisJs Framework</a></p>
				</blockquote>
				<p>The <code>response/res</code> object in Node.js and in many popular frameworks like Express, Fastify will write the response body as soon as you will call <code>res.send</code> method.</p>
				<p>This is okay, if your HTTP request stack is simple and doesn&#39;t have many abstraction layers. However, if you <strong>heavily make use of middleware</strong> and want to modify the response body inside a middleware, it&#39;s impossible to do that.</p>
				<p>Whereas, this module comes with a switch <code>(explicitEnd)</code>, using that you can tell it to not write the response unless <code>response.finish</code> is called explicitly.</p>
				<pre><code class="language-js">http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">new</span> Response(req, res, {})

  response.explicitEnd = <span class="hljs-literal">true</span>

  <span class="hljs-comment">// response is saved in memory</span>
  response.send({ <span class="hljs-attr">ok</span>: <span class="hljs-literal">true</span> })

  response.hasLazyBody <span class="hljs-comment">// true</span>
  response.lazyBody <span class="hljs-comment">// { writer, args: [] }</span>

  <span class="hljs-comment">// now writing</span>
  response.finish()
})</code></pre>
				<p>This is how <code>explicitEnd=true</code> works in nutshell</p>
				<ol>
					<li>Any calls to methods <code>send</code>, <code>json</code>, <code>jsonp</code> will be buffered and stored inside memory.</li>
					<li>No headers will be set.</li>
					<li>Consecutive calls to previous methods will override the existing memory reference with the new one.</li>
					<li>The response is only written to the TCP socket when <code>response.finish</code> is called.</li>
					<li>Consecutive calls to <code>response.finish</code> results in a <code>noop</code>.</li>
				</ol>
				<h2 id="typescript-support">Typescript support</h2>
				<p>The module is written in Typescript, so expect intellisense to work out of the box. Also an interface is exported, which you can extend if extending the original <code>Response</code> class.</p>
				<pre><code class="language-ts"><span class="hljs-keyword">import</span> { ResponseContract } <span class="hljs-keyword">from</span> <span class="hljs-string">'node-res'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> IResponse <span class="hljs-keyword">extends</span> ResponseContract {
  myCustomMethod (): <span class="hljs-built_in">string</span>
}</code></pre>
				<p>and then use it as follows</p>
				<pre><code class="language-ts"><span class="hljs-keyword">import</span> { IResponse } <span class="hljs-keyword">from</span> <span class="hljs-string">'./my/interfaces'</span>

http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">new</span> Response(req, res, {}) <span class="hljs-keyword">as</span> unknown <span class="hljs-keyword">as</span> IResponse
  response.myCustomMethod() <span class="hljs-comment">// intellisense works</span>
})</code></pre>
				<h2 id="extending-via-macros">Extending via Macros</h2>
				<p>The module extends <a href="https://github.com/poppinss/macroable">macroable</a>, which allows extending classes from outside in. You can use the following methods to extend the prototype of the <code>Response</code> class.</p>
				<pre><code class="language-js"><span class="hljs-keyword">import</span> { Response } <span class="hljs-keyword">from</span> <span class="hljs-string">'node-res'</span>

<span class="hljs-comment">// Added as a method</span>
Response.macro(<span class="hljs-string">'status'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.response.statusCode
})

<span class="hljs-comment">// Added as property</span>
Response.getter(<span class="hljs-string">'status'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.response.statusCode
})

<span class="hljs-comment">// Added as singleton property</span>
Response.getter(<span class="hljs-string">'status'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.response.statusCode
}, <span class="hljs-literal">true</span>)</code></pre>
				<p>Later, using the request instance, you can use <code>getters</code> and <code>macros</code>.</p>
				<pre><code class="language-js">http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">new</span> Response(req, res, {})

  response.status <span class="hljs-comment">// getter</span>
  response.status() <span class="hljs-comment">// macro</span>
})</code></pre>
				<h2 id="difference-from-other-frameworks">Difference from other frameworks</h2>
				<p><strong>You don&#39;t need this module, if you are using Express or Koa</strong>, since their <code>res</code> object is already decorated with handful of convenient getters.</p>
				<p>In case you are building a framework or using a framework like <a href="https://github.com/zeit/micro">micro</a>, then this module can save lots of time.</p>
				<h2 id="api">API</h2>
				<p>The API docs are generated using TypeDoc and can be found <a href="https://node-res.netlify.com/classes/_request_.request.html">here</a>.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/http.html">http</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-module"><span class="tsd-kind-icon">Module</span></li>
				<li class="tsd-kind-object-literal"><span class="tsd-kind-icon">Object literal</span></li>
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-index-signature"><span class="tsd-kind-icon">Index signature</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
				<li class="tsd-kind-enum-member"><span class="tsd-kind-icon">Enumeration member</span></li>
				<li class="tsd-kind-property tsd-parent-kind-enum"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-enum"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-interface"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
				<li class="tsd-kind-class tsd-has-type-parameter"><span class="tsd-kind-icon">Class with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class"><span class="tsd-kind-icon">Accessor</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-class"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-call-signature tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="http://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="assets/js/search.js"><' + '/script>');</script>
</body>
</html>